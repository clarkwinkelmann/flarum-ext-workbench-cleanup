(()=>{var n={n:e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},d:(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},o:(n,e)=>Object.prototype.hasOwnProperty.call(n,e)};(()=>{"use strict";const e=flarum.core.compat["admin/app"];var t=n.n(e);const o=flarum.core.compat["common/components/Button"];var i=n.n(o);const r=flarum.core.compat["common/components/LoadingIndicator"];var a=n.n(r);const s=flarum.core.compat["common/components/Dropdown"];var c=n.n(s);function l(n){return n>1e9?Math.round(n/1e9)+"GB":n>1e6?Math.round(n/1e6)+"MB":n>1e3?Math.round(n/1e3)+"kB":n+"B"}var d={alpha:"Alphabetically",vendor:"Vendor size",node_modules:"Node size",git:"Git size",total:"Total size"};function u(n,e,t){void 0===t&&(t=!1);var o=n.indexOf(e);t?-1===o&&n.push(e):-1!==o&&n.splice(o,1)}var h=function(){function n(){this.loading=!0,this.folders=null,this.cleaningExtension=[],this.cleaningType=[],this.sort="alpha"}var e=n.prototype;return e.refresh=function(){var n=this;this.loading=!0,this.folders=null,t().request({method:"POST",url:t().forum.attribute("apiUrl")+"/workbench-cleanup/inspect"}).then((function(e){n.folders=e,n.loading=!1,m.redraw()})).catch((function(e){throw n.loading=!1,m.redraw(),e}))},e.clean=function(n,e,o){var i=this;u(this.cleaningExtension,e,!0),u(this.cleaningType,o,!0),t().request({method:"POST",url:t().forum.attribute("apiUrl")+"/workbench-cleanup/clean",body:{folder:n,extension:e,type:o}}).then((function(n){n&&Array.isArray(n.deleted)&&i.folders&&n.deleted.forEach((function(n){i.folders.forEach((function(e){e.path===n.folder&&Object.keys(e.extensions).forEach((function(t){t===n.extension&&e.extensions[t][n.type]&&(e.extensions[t].total-=e.extensions[t][n.type],delete e.extensions[t][n.type])}))}))})),u(i.cleaningExtension,e,!1),u(i.cleaningType,o,!1),m.redraw()})).catch((function(n){throw u(i.cleaningExtension,e,!1),u(i.cleaningType,o,!1),m.redraw(),n}))},e.oninit=function(){this.refresh()},e.view=function(){var n=this;return[i().component({className:"Button",onclick:function(){n.refresh()},disabled:this.loading},"Refresh")," ",c().component({label:"Sort: "+d[this.sort],buttonClassName:"Button"},Object.keys(d).map((function(e){return i().component({onclick:function(){n.sort=e}},d[e])}))),m(".WorkbenchCleanup",this.loading?a().component():this.list())]},e.isLoading=function(n,e){return(this.cleaningExtension.includes(n)||this.cleaningExtension.includes("*"))&&this.cleaningType.includes(e)},e.list=function(){var n=this;return Array.isArray(this.folders)?0===this.folders.length?m("p","No workbench folders found"):this.folders.map((function(e){var t=Object.keys(e.extensions).sort((function(t,o){return"alpha"===n.sort?t>o?1:-1:(e.extensions[t][n.sort]||0)>(e.extensions[o][n.sort]||0)?-1:1})),o=0,r=0,a=0,s=0,c=t.map((function(t){var c=e.extensions[t],d=c.total,u=c.vendor,h=c.node_modules,f=c.git,p=d-(u||0)-(h||0)-(f||0);return o+=p,r+=u||0,a+=h||0,s+=f||0,m("tr",[m("td",t),m("td",[i().component({className:"Button Button--icon",icon:"fas fa-eraser",onclick:function(){n.clean(e.path,t,"vendor")},loading:n.isLoading(t,"vendor"),disabled:!u})," ",u?l(u):m("em","Not found")]),m("td",[i().component({className:"Button Button--icon",icon:"fas fa-eraser",onclick:function(){n.clean(e.path,t,"node_modules")},loading:n.isLoading(t,"node_modules"),disabled:!h})," ",h?l(h):m("em","Not found")]),m("td",f?l(f):m("em","Not found")),m("td",l(p)),m("td",l(d))])}));return[m("h3",e.path),m("table",[m("thead",[m("tr",[m("th","Extension"),m("th","vendor"),m("th","node_modules"),m("th","git"),m("th","code"),m("th","everything")]),m("tr",[m("th","Total"),m("th",[i().component({className:"Button Button--icon",icon:"fas fa-eraser",onclick:function(t){(t.shiftKey||confirm("Delete all vendor folders in "+e.path))&&n.clean(e.path,"*","vendor")},loading:n.isLoading("*","vendor"),disabled:0===r})," ",r>0?l(r):m("em","None found")]),m("th",[i().component({className:"Button Button--icon",icon:"fas fa-eraser",onclick:function(t){(t.shiftKey||confirm("Delete all node_modules folders in "+e.path))&&n.clean(e.path,"*","node_modules")},loading:n.isLoading("*","node_modules"),disabled:0===a})," ",a>0?l(a):m("em","None found")]),m("th",l(s)),m("th",l(o)),m("th",l(o+r+a+s))])]),m("tbody",c)])]})):m("p","An error occurred")},n}();t().initializers.add("clarkwinkelmann-workbench-cleanup",(function(){t().extensionData.for("clarkwinkelmann-workbench-cleanup").registerSetting((function(){return m(h)})).registerSetting({type:"textarea",setting:"workbench-cleanup.folders",label:"Custom list of workbench folders",placeholder:"Leave empty to scan composer.json. When customizing, one absolute path per line"})}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map